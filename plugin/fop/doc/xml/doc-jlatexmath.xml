<?xml  version="1.0"  encoding="UTF-8"  ?>  

<!--
indexing
	description   : 
	"{
	Documentation de première intention pour l'utilisation du  paquetage 
	'JLaTeXMath' permettant d'éditer des équations dans un document préparé 
	avec DocBook.
	}"
	auteurs       : "Christophe HARO et Calixte DENIZET"
	copyright_auteur : "Auteur : (c) Christophe HARO, 2010"
	copyright_auteur : "Auteur : (c) Calixte DENIZET, 2010"
	licenses_url  : "http://www.gnu.org/licenses/gpl-3.0.html"
	licence       : "FDL"
	projet        : "JLATEXMATH"
	dossier       : "${DOCBOOK}/jlatexmath/xml/"
	fichier       : "doc-jlatexmath.xml"
	date          : "$Date: 2010-04-16 16:31:47 +0200 (Ven 16 avr 2010) $"
	revision      : "$Revision: 16 $"
	url           : "$HeadURL: svn://localhost/jlatexmath/xml/doc-jlatexmath.xml $"
	modifications : "$Author: haro $"
-->

<!DOCTYPE article [
<!ENTITY projet     "file:///Users/haro/DocBook/documentation/jlatexmath/">
<!ENTITY programmes "&projet;programmes/">
<!ENTITY equations  "&projet;equations/">
<!ENTITY % entites SYSTEM "/Users/haro/DocBook/inclusions/entites.ent">
%entites;
]>

<article 
	xml:id="doc-jlatexmath"
	xmlns="http://docbook.org/ns/docbook"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:xi="http://www.w3.org/2001/XInclude"
	xmlns:svg="http://www.w3.org/2000/svg"
	xmlns:mml="http://www.w3.org/1998/Math/MathML"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:db5="http://docbook.org/ns/docbook"
	xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
	xml:lang="fr"
	version="5.0">

  <info>
    <title>DocBook et les formules mathématiques</title>
	<subtitle>Utiliser <jlm:latex style="text">\JLaTeXMath</jlm:latex></subtitle>
	<titleabbrev><jlm:latex style="text">\JLaTeXMath</jlm:latex></titleabbrev>

    <author>
	  <personname>
		<firstname>Christophe</firstname>
		<surname>HARO</surname>
	  </personname>

      <affiliation>
		<address>
          <email>Christophe.HARO@ac-nantes.fr</email>
        </address>
      </affiliation>
    </author>

	<author>
	  <personname>
		<firstname>Calixte</firstname>
		<surname>DENIZET</surname>
	  </personname>

	  <affiliation>
		<address>
		  <email>Calixte.DENIZET@ac-rennes.fr</email>
		</address>
	  </affiliation>
	</author>

	<copyright xml:lang="en">
	  <year><?dbtimestamp format="Y"?></year>
	  <holder>Christophe HARO and Calixte DENIZET</holder>
	</copyright>

	<legalnotice>
	  <para xml:lang="en">
		Permission is granted to  copy, distribute and/or modify this document under the terms  of the GNU Free Documentation
		License, Version 1.2 or  any later version published by the Free Software Foundation;  with no Invariant Sections, no
		Front-Cover Texts,  and no Back-Cover  Texts. A copy  of the license  is included in  the section entitled  "GNU Free
		Documentation License".
	  </para>

	  <screen>
Notes de révision
      dernier commit :"$Date: 2010-04-16 16:31:47 +0200 (Ven 16 avr 2010) $"
dernière compilation : <?dbtimestamp format="d-m-Y H:M:S"?>
            revision : "$Revision: 16 $"
                 url : "$HeadURL: svn://localhost/jlatexmath/xml/doc-jlatexmath.xml $"
       modifications : "$Author: haro $"
	  </screen>
	</legalnotice>

	<abstract>
	  <para>
		Ce document  montre comment utiliser  quelques commandes <jlm:latex  style="text" >\LaTeX</jlm:latex> pour  éditer un
		texte  scientifique au  format  <command>DocBook</command>.  Il  s'agit  de réaliser  une  petite démonstration  pour
		présenter le rendu obtenu dans une sortie au format PDF d'un texte Mathématique incluant des équations.
	  </para>
	</abstract>
  </info>

  <warning>
	<title>Source des programmes présentés</title>

	<para>
	  Pour  des  raisons techniques,  les  sources des  programmes  présentés  ne sont  pas  exactement  ceux des  programmes
	  réels. Ainsi, par exemple, lorsqu'un  environnement multi-ligne de <jlm:latex style="text">\LaTeX</jlm:latex> nécessite
	  de  placer le  caractère <varname><![CDATA[&]]></varname>,  celui-ci devrait  être échappé  puisque c'est  un caractère
	  réservé  de XML.  Le  code source  réel, tel  qu'il apparaît  dans les  fichiers joints,  encadre les  instructions des
	  expressions  mathématiques  par   les  balises  <varname><![CDATA[<![CDATA[]]>&nbsp;&hellip;&nbsp;]]&gt;</varname>  qui
	  échappent ainsi les  caractères réservés de XML.  Cependant,  ces balises ne peuvent être imbriquées  dans les éléments
	  <varname><![CDATA[<programlisting>]]></varname>. Elles n'apparaissent donc pas dans ce document, mais il faudra veiller
	  à les rétablir pour obtenir des programmes XML valides.
	</para>
  </warning>

<section xml:id="introduction">
  <title>Introduction</title>

  <para>
	Ce texte a été composé avec EMACS dans le  mode majeur nXML.  Le système de composition est <command>DocBook</command> en
	version 5.0 XML validé par le schéma RELAX NG.  Les feuilles de styles XSLT sont utilisées par XMLLINT pour la validation
	et la résolution des inclusions externes. SAXON est le  processeur XSLT et FOP réalise la composition des textes imprimés
	au format <filename  class="extension">pdf</filename>.  La composition à l'aide de FOP  utilise les extensions <jlm:latex
	style="text">\JLaTeXMath</jlm:latex> pour le rendu des équations et des expressions mathématiques.
  </para>

  <para>
	La composition d'expressions  mathématiques avec <command>DocBook</command> n'est pas simple et,  surtout, donne un rendu
	qui  n'est pas  satisfaisant comparé  à celui  que permet  <jlm:latex style="text">\LaTeX</jlm:latex>  et  ses paquetages
	d'extensions. Il existe différents  projets qui tentent de rassembler le meilleur des  deux mondes.  Le projet <jlm:latex
	style="text">\JLaTeXMath</jlm:latex> développé par  Calixte DENIZET est de ceux-là. Il  permet d'intégrer simplement dans
	un  texte  <filename  class="extension">xml</filename>  au  format  <command>DocBook</command>  certaines  des  commandes
	<jlm:latex style="text">\LaTeX</jlm:latex> les plus utiles pour composer les expressions mathématiques.
  </para>

  <para>
	<jlm:latex style="text">\JLaTeXMath</jlm:latex> est une API <command>Java</command>. Son utilisation est simple, efficace
	et        robuste.        La        page        d'acceuil        du        projet,        à        l'adresse        <link
	xlink:href="http://forge.scilab.org/index.php/p/jlatexmath/"/>, vous en dira plus.
  </para>

  <para>
	L'objectif de cette documentation est de donner  quelques exemples simples de composition d'expressions mathématiques. Ce
	n'est donc un tutoriel ni sur <command>DocBook</command>, ni sur <jlm:latex style="text">\LaTeX</jlm:latex>. Ce n'est pas
	non plus une étude exhaustive des  possibilités de <jlm:latex style="text">\JLaTeXMath</jlm:latex>. Les références en fin
	de  texte permettront  d'aller  plus loin  pour ceux  que  cela intéresse.   Elle  s'adresse au  débutant sans  expertise
	particulière  sur <command>DocBook</command> pour  lui permettre  de démarrer  rapidement avec  la composition  de textes
	scientifiques. Cependant, elle ne lui économisera pas les efforts nécessaires pour l'utiliser efficacement.
  </para>

  <para>
	La  <xref xlink:href="#installation-adaptation"/>,  donne quelques  indications  pour installer  le paquetage  <jlm:latex
	style="text">\JLaTeXMath</jlm:latex> et  pour configurer la feuille de  style afin d'en utiliser  les fonctionnalités. La
	<xref    xlink:href="#exemples"/>,    montre   quelques    exemples    de    composition    d'expressions.    La    <xref
	xlink:href="#complements"/>, complète  ces éléments  et montre comment  changer les  polices de caractères  utilisées par
	défaut pour se  rapprocher encore un peu plus  du rendu obtenu avec <jlm:latex  style="text">\LaTeX</jlm:latex>. La <xref
	xlink:href="#listing"/>,  montre  sur  un  exemple  simple  comment  insérer  une  expression  composée  avec  <jlm:latex
	style="text">\JLaTeXMath</jlm:latex> dans les  commentaires du code source d'un programme  informatique pour compléter sa
	documentation. Le document conclut par quelques références utilisées pour composer ce texte.
  </para>
</section>

<section xml:id="installation-adaptation">
  <title>Installation du paquetage et adaptation de la feuille de style</title>

  <para>
	Il  n'y a  pas d'installation  de <jlm:latex  style="text">\JLaTeXMath</jlm:latex> au  sens propre.  Il suffit  de placer
	l'archive  <filename  class="libraryfile">jlatexmath-embedded-fop-x.y.z.jar</filename>  dans  un dossier  accessible  par
	<command>FOP</command> et d'ajuster la feuille de style <filename class="extension">xsl</filename>. Cette section indique
	comment faire.
  </para>

  <section xml:id="installation">
	<title>Installation de <jlm:latex style="text">\JLaTeXMath</jlm:latex></title>

	<para>
	  Commencer par  télécharger l'archive <filename  class="libraryfile">jlatexmath-embedded-fop-x.y.z.zip</filename> depuis
	  le         site         du        projet.          L'adresse         de         téléchargement        est         <link
	  xlink:href="http://forge.scilab.org/index.php/p/jlatexmath/downloads/"/> et la  version <varname>x.y.z</varname> est la
	  <varname>0.9.1</varname>(<?dbtimestamp  format="d-m-Y"?>).  Déballer cette  archive dans  un dossier  quelconque.  Elle
	  contient le fichier <filename class="libraryfile">jlatexmath-embedded-fop-x.y.z.jar</filename> qui doit être accessible
	  à  <command>FOP</command>. Vous avez  deux possibilités&nbsp;:  ajuster le  <varname>CLASSPATH</varname> qui  donne les
	  chemins d'accès aux  classes <command>Java</command> utilisées par <command>FOP</command> ou  placer cette archive dans
	  le dossier <filename class="directory">lib/</filename> du répertoire dans lequel est installé <command>FOP</command>.
	</para>

	<para>
	  L'ajustement de  la valeur de  la variable  d'environnement <varname>CLASSPATH</varname> met  en jeu des  commandes qui
	  dépendent du système d'exploitation hôte et du processeur  de commandes utilisé par l'utilisateur de ce système. Sur un
	  système  UNIX par  exemple  et  pour un  utilisateur  d'un tel  système  pour  lequel le  processeur  de commandes  est
	  <command>bash</command> ou <command>sh</command>, l'ajustement est réalisé par la commande&nbsp;:
	</para>

	<screen>
	  $ export CLASSPATH=${CLASSPATH}:chemin/jlatexmath-embedded-fop-x.y.z.jar
	</screen>

	<para>
	  Dans cette commande, il faut évidemment remplacer <filename class="directory">chemin</filename> par le chemin d'accès à
	  l'archive,  c'est   à  dire  le   nom  du  dossier  dans   lequel  elle  a   été  placée.   Il  faut   aussi  remplacer
	  <varname>x.y.z</varname> par  leurs valeurs effectives. Le caractère  <varname>$</varname> qui débute la  ligne ne doit
	  pas  être tapé.  Il  est mis  ici pour  figurer le  caractère d'invite  (<emphasis>prompt</emphasis>) du  processeur de
	  commandes et  peut différer selon la configuration  du système.  Ainsi, par  exemple sur le calculateur  sur lequel est
	  tapé ce texte, le prompt est <varname>callisto:~ haro$</varname>.
	</para>

	<para>
	  Une   méthode  plus   rapide  consiste   à  placer,   si   c'est  possible,   l'archive  dans   le  dossier   <filename
	  class="directory">lib/</filename> du répertoire d'installation de  <command>FOP</command>. Dans ce cas, la modification
	  de <varname>CLASSPATH</varname> n'est pas nécessaire.
	</para>
  </section>

  <section xml:id="adaptation">
	<title>Adaptation de la feuille de style</title>

	<para>
	  Il  s'agit de  préparer une  feuille de  style primaire  qui va  définir les  commandes nécessaires  pour  permettre la
	  traduction des éléments <jlm:latex style="text">\JLaTeXMath</jlm:latex>, mais  qui va aussi charger la feuille de style
	  &laquo;&nbsp;normale&nbsp;&raquo; de la distribution <command>DocBook</command>.
	</para>

	<para>
	  Au  lieu  de préciser  dans  chaque  instance de  l'élément  <varname>&lt;latex&gt;</varname>  l'espace  de nom,  comme
	  ceci&nbsp;:

<programlisting language="myxml">
<![CDATA[
		 <jlm:latex xmlns:jlm="http://forge.scilab.org/p/jlatexmath">
		   ...
		 </jlm:latex>
]]>
</programlisting>

      la feuille  de style définit le  préfixe <varname>jlm</varname>. L'en-tête du  fichier qui définit la  feuille de style
	  est, par exemple&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
                xmlns:latex="http://forge.scilab.org/p/jlatexmath"
				xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
				...
				   définition des autres espaces de noms
				...
                exclude-result-prefixes="... latex jlm"
                version="1.0">

<!-- Chargement des autres feuilles de styles -->
<xsl:import href=".../fo/docbook.xsl"/>
<xsl:import href=".../highlighting/common.xsl" />
<xsl:import href=".../fo/highlight.xsl" />
...
]]>
</programlisting>

	<para>
	  Bien entendu, les pointillés doivent être remplacés par ce qui manque ou éliminés si votre feuille de style est réduite
	  aux adaptations nécessaires à <jlm:latex style="text">\JLaTeXMath</jlm:latex>.
	</para>

	<para>
	  Il reste alors à rajouter la partie concernant l'élément <varname><![CDATA[<latex>]]></varname>.
	</para>

<programlisting language="myxml">
<![CDATA[
...
<!-- Utiliser les commandes LaTeX pour éditer les équations -->

<xsl:template match="latex:*">
  <xsl:choose>
    <xsl:when test="@align != ''">
      <fo:block>
	<xsl:attribute name="text-align">
	  <xsl:value-of select="@align"/>
	</xsl:attribute>
	<fo:instream-foreign-object>
	  <xsl:copy>
	    <xsl:copy-of select="@*"/>
	    <xsl:if test="@align = 'center'">
	      <xsl:attribute name="fwidth">
		<xsl:value-of select="concat(
		                            $page.width,',-',
									$body.start.indent,',-',
									$page.margin.inner,',-',
									$page.margin.outer
									)"/>
	      </xsl:attribute>
	    </xsl:if>
	    <xsl:apply-templates/>
	  </xsl:copy>
	</fo:instream-foreign-object>
      </fo:block>
    </xsl:when>
    <xsl:otherwise>
      <fo:instream-foreign-object>
	<xsl:copy>
	  <xsl:copy-of select="@*"/>
	  <xsl:apply-templates/>
	</xsl:copy>
      </fo:instream-foreign-object>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

</xsl:stylesheet>
]]>
</programlisting>

	<para>
	  Ce segment  de code  de la feuille  de style compose  le fichier  <filename>latex.xsl</filename> placé dans  le dossier
	  <filename  class="directory">examples/</filename>  de  l'archive  du  projet.   Il suffit  donc  de  la  copier/coller.
	  Finalement, l'adaptation complète de la feuille de style devient&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
                xmlns:latex="http://forge.scilab.org/p/jlatexmath"
				xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
				...
				   définition des autres espaces de noms
				...
                exclude-result-prefixes="... latex jlm"
                version="1.0">

<!-- Chargement des autres feuilles de styles -->
<xsl:import href=".../fo/docbook.xsl"/>
<xsl:import href=".../highlighting/common.xsl" />
<xsl:import href=".../fo/highlight.xsl" />

...

<!-- Utiliser les commandes LaTeX pour éditer les équations -->

<xsl:template match="latex:*">
  <xsl:choose>
    <xsl:when test="@align != ''">
      <fo:block>
	<xsl:attribute name="text-align">
	  <xsl:value-of select="@align"/>
	</xsl:attribute>
	<fo:instream-foreign-object>
	  <xsl:copy>
	    <xsl:copy-of select="@*"/>
	    <xsl:if test="@align = 'center'">
	      <xsl:attribute name="fwidth">
		<xsl:value-of select="concat(
		                            $page.width,',-',
									$body.start.indent,',-',
									$page.margin.inner,',-',
									$page.margin.outer
									)"/>
	      </xsl:attribute>
	    </xsl:if>
	    <xsl:apply-templates/>
	  </xsl:copy>
	</fo:instream-foreign-object>
      </fo:block>
    </xsl:when>
    <xsl:otherwise>
      <fo:instream-foreign-object>
	<xsl:copy>
	  <xsl:copy-of select="@*"/>
	  <xsl:apply-templates/>
	</xsl:copy>
      </fo:instream-foreign-object>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template>

</xsl:stylesheet>
]]>
</programlisting>

	<para>
	  Pour éditer un texte, il suffit de définir les espaces  de noms et de préfixer les éléments dans le texte. Les préfixes
	  définis  sont  libres.   Ce  texte,  par   exemple,  utilise  le  préfixe  <varname>jlm:</varname>  pour  les  éléments
	  <varname><![CDATA[<latex>]]></varname>, mais ce n'est pas une  obligation. Les définitions utilisées pour ce texte sont
	  les suivantes&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<article xml:id="doc-jlatexmath"
	xmlns="http://docbook.org/ns/docbook"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	xmlns:xi="http://www.w3.org/2001/XInclude"
	xmlns:svg="http://www.w3.org/2000/svg"
	xmlns:mml="http://www.w3.org/1998/Math/MathML"
	xmlns:html="http://www.w3.org/1999/xhtml"
	xmlns:db5="http://docbook.org/ns/docbook"
	xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
	xml:lang="fr"
	version="5.0">
...
</article>
]]>
</programlisting>

	<para>
	  Ce qui permet ensuite de composer les éléments comme cela a été précisé au tout début de cette section.
	</para>
  </section>
</section>

<section xml:id="exemples">
  <title>Exemples de composition avec <jlm:latex style="text">\JLaTeXMath</jlm:latex></title>

  <example xml:id="ex-eq-1">
	<title>Une première tentative</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  Commençons par une première tentative. Il s'agit d'une équation simple, sans titre ni numérotation. Le programme source
	  pour cette équation est&nbsp;:
	</para>

<programlisting language="myxml">
  <![CDATA[
<para>
  <jlm:latex>
      \sum_{i=0}^{i=n}{i} = \frac{n \times (n+1)}{2}
  </jlm:latex>
</para>
  ]]>
</programlisting>

    <para>
	  Il suffit donc  de placer les instructions <jlm:latex style="text">\LaTeX</jlm:latex> qui  composent l'équation dans un
	  paragraphe. on obtient&nbsp;:
	</para>

	<para>
	  <jlm:latex>
				\sum_{i=0}^{i=n}{i} = \frac{n \times (n+1)}{2}
	  </jlm:latex>
	</para>

	<para>
	  La même  expression peut aussi être  composée pour être intégrée  au texte de la  ligne en cours. Il  s'agit donc d'une
	  expression  &laquo;&nbsp;en  ligne&nbsp;&raquo;  (<emphasis>in-line</emphasis>).    Il  suffit  de  définir  l'attribut
	  <varname>style</varname>  de  l'élément  <varname><![CDATA[<jlm:latex>]]></varname>  et  de  lui  attribuer  la  valeur
	  <option>"text"</option>, comme ceci&nbsp;:
	</para>

<programlisting language="myxml">
  <![CDATA[
<para>
  Ceci est le texte d'un paragraphe dont une ligne contient une expression 
  mathématique composée avec <jlm:latex style="text">\LaTeX</jlm:latex>.
  L'expression est

  <jlm:latex style="text">
      \sum_{i=0}^{i=n}{i} = \frac{n \times (n+1)}{2}
  </jlm:latex>

  et elle s'intègre parfaitement au texte. La taille des caractères est ajustée 
  automatiquement.
</para>
  ]]>
</programlisting>

    <para>
	  On obtient alors le résultat suivant&nbsp;:
	</para>

	<para>
	  Ceci  est le  texte d'un  paragraphe  dont une  ligne contient  une  expression mathématique  composée avec  <jlm:latex
	  style="text" >\LaTeX</jlm:latex>. L'expression est

	  <jlm:latex style="text">
	    \sum_{i=0}^{i=n}{i} = \frac{n \times (n+1)}{2}
	  </jlm:latex>

	  et elle s'intègre parfaitement au texte. La taille des caractères est ajustée automatiquement.
	</para>

	<para>
	  La   formule   n'est    pas   vraiment   impressionnante   et   pas   difficile   à    préparer,   même   sans   <latex
	  xmlns="http://forge.scilab.org/p/jlatexmath" style="text">\JLaTeXMath</latex>.  Voyons un second exemple, toujours sans
	  numérotation, mais un peu plus compliqué.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-eq-1"/>.</para>
  </example>

  <example xml:id="ex-eq-2">
	<title>Un exemple d'équation plus élaborée</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  Voici le résultat à obtenir&nbsp;:
	</para>

	<para>
	  <jlm:latex>
		<![CDATA[
			  \phi_n(\kappa)     =    \frac{1}{4\pi^2\kappa^2}    \int_0^\infty     \frac{\sin(\kappa    R)}{\kappa    R}
			  \frac{\partial}{\partial R}\left[ R^2\frac{\partial D_n(R)}{\partial R}\right]\,dR 
		]]>
	  </jlm:latex>
	</para>

	<para>
	  Les instructions  nécessaires pour obtenir ce  résultat sont évidemment plus  difficiles à écrire. Le  programme est le
	  suivant&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<para>
  <jlm:latex>
    \phi_n(\kappa) = \frac{1}{4\pi^2\kappa^2} \int_0^\infty \frac{\sin(\kappa R)}{\kappa R}
	\frac{\partial}{\partial R}\left[ R^2\frac{\partial D_n(R)}{\partial R}\right]\,dR 
  </jlm:latex>
</para>
]]>
</programlisting>

    <para>
	
	</para>

	<para>
	  Essayons encore avec une expression utilisant une matrice. Voici ce que nous souhaitons obtenir&nbsp;:
	</para>

	<para>
	  <jlm:latex>
		<![CDATA[
			   \det
			       \begin{bmatrix}
				       a_{11}&a_{12}&\cdots&a_{1n}\\
					   a_{21}&\ddots&&\vdots\\
					   \vdots&&\ddots&\vdots\\
					   a_{n1}&\cdots&\cdots&a_{nn}
				   \end{bmatrix}
				   \overset{\mathrm{def}}{=}\sum_{\sigma\in\mathfrak{S}_n}\varepsilon(\sigma)\prod_{k=1}^n
				   a_{k\sigma(k)}
		]]>
	  </jlm:latex>
	</para>

	<para>
	  Le programme s'écrit&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<para>
  <jlm:latex>
    \det
	\begin{bmatrix}
        a_{11}&a_{12}&\cdots&a_{1n}\\
		a_{21}&\ddots&&\vdots\\
		\vdots&&\ddots&\vdots\\
		a_{n1}&\cdots&\cdots&a_{nn}
	\end{bmatrix}
	\overset{\mathrm{def}}{=}\sum_{\sigma\in\mathfrak{S}_n}\varepsilon(\sigma)\prod_{k=1}^n
	a_{k\sigma(k)}
  </jlm:latex>
</para>
]]>
</programlisting>

    <para>
	  Remarquer l'utilisation de la  police de caractères \mathfrak. Bien entendu, nous  devrions utiliser des environnements
	  plus spécialisés pour améliorer la composition, par exemple  pour ajuster l'espacement qui précède et qui suit le signe
	  <jlm:latex  style="text">\overset{\mathrm{def}}{=}  </jlm:latex>.   C'est  tout  à fait  possible  avec  les  commandes
	  <option>\mathclap</option>,    <option>\mathllap</option>,&nbsp;&hellip;   qui    sont    reconnues   par    <jlm:latex
	  style="text">\JLaTeXMath</jlm:latex> mais nous en resterons là pour cette initiation.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-eq-2"/>.</para>
  </example>

  <example xml:id="ex-eq-3">
	<title>Équation numérotée avec son titre</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  Les équations sont habituellement numérotées afin de pouvoir y faire référence dans le texte.  Pour que l'équation soit
	  numérotée, elle  doit être enveloppée dans un  élément <varname><![CDATA[<equation>]]></varname> et un  titre doit être
	  défini  dans le sous-élément  <varname><![CDATA[<title>]]></varname>.  Enfin,  l'équation sera  référencée à  l'aide de
	  l'identifiant      défini     comme      valeur      de     l'attribut      <varname>id</varname>     de      l'élément
	  <varname><![CDATA[<equation>]]></varname>. Le programme de l'équation précédente devient&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<para>
  <equation xml:id="matrice">
    <title>Une équation numérotée</title>

    <jlm:latex>
      \det
	  \begin{bmatrix}
        a_{11}&a_{12}&\cdots&a_{1n}\\
		a_{21}&\ddots&&\vdots\\
		\vdots&&\ddots&\vdots\\
		a_{n1}&\cdots&\cdots&a_{nn}
	  \end{bmatrix}
	  \overset{\mathrm{def}}{=}\sum_{\sigma\in\mathfrak{S}_n}\varepsilon(\sigma)\prod_{k=1}^n
	  a_{k\sigma(k)}
  </jlm:latex>

  </equation>
</para>
]]>
</programlisting>

    <para>
	  Avec le résultat suivant&nbsp;:
	</para>

	<para>
	  <equation xml:id="matrice">
		<title>Une équation numérotée</title>

		<jlm:latex>
		  <![CDATA[
				 \det
				 \begin{bmatrix}
				   a_{11}&a_{12}&\cdots&a_{1n}\\
				   a_{21}&\ddots&&\vdots\\
				   \vdots&&\ddots&\vdots\\
				   a_{n1}&\cdots&\cdots&a_{nn}
				 \end{bmatrix}
				 \overset{\mathrm{def}}{=}\sum_{\sigma\in\mathfrak{S}_n}\varepsilon(\sigma)\prod_{k=1}^n
				 a_{k\sigma(k)}
		  ]]>
		</jlm:latex>
	  </equation>
	</para>

	<para>
	  La référence à cette équation utilise son identifiant dans le texte, comme ceci&nbsp;:
	</para>

	<para>
	  L'équation  <xref xlink:href="#matrice"/>  ci-dessus définit  le déterminant  de la  matrice.  Elle  utilise  la police
	  \mathfrak.
	</para>

	<para>
	  Le programme de la référence est&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
  <para>
	L'équation <xref xlink:href="#matrice"/> ci-dessus définit le déterminant 
	de la matrice.  Elle utilise la police \mathfrak.
  </para>
]]>
</programlisting>

    <para>
	  Remarquer que le numéro dans le texte est  &laquo;&nbsp;cliquable&nbsp;&raquo;. En fait, il est programmé dans le texte
	  comme un lien sur l'identifiant de l'équation. 
	</para>

	<para>
	  Lorsque l'équation est numérotée, l'espace de la largeur de la page est divisé en deux parties. La partie gauche reçoit
	  l'expression et la  partie droite le numéro  de référence.  Par défaut, l'expression  est centrée dans sa  partie et le
	  numéro est cadré à droite dans la sienne.  Ces  placements sont configurables en ajustant la feuille de style <filename
	  class="extension">xsl</filename>,  mais ces ajustements  dépassent le  cadre de  cette documentation  d'initiation. Les
	  références en fin d'article permettent d'aller plus loin.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-eq-3"/>.</para>
  </example>

  <example xml:id="ex-eq-4">
	<title>Équation à &laquo;&nbsp;plusieurs dimensions&nbsp;&raquo;</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  L'expression  &laquo;&nbsp;plusieurs  dimensions&nbsp;&raquo; signifie  simplement  que  l'équation occupera  plusieurs
	  lignes   dont   il   faut   assurer   une    présentation   harmonieuse.   C'est   ce   que   la   culture   <jlm:latex
	  style="text">\LaTeX</jlm:latex>          désigne          par          l'expression          &laquo;&nbsp;environnement
	  <emphasis>multi-line</emphasis>&nbsp;&raquo;.  Voyons d'abord une équation à deux dimensions.
	</para>

	<para>
	  La suite de Fibonacci est définie par&nbsp;:

	  <equation xml:id="fibonacci">
		<title>Définition de la suite de Fibonacci</title>

		<xi:include 
			xmlns:xi="http://www.w3.org/2001/XInclude"
			href="&equations;eq-2dim.xml"
			parse="xml"/>
	  </equation>
	</para>

	<para>
	  La suite <xref xlink:href="#fibonacci"/> est définie par une  expression présentée sur deux lignes selon le domaine des
	  valeurs  de <jlm:latex  style="text">i</jlm:latex>.  Pour  obtenir ce  résultat, le  programme  utilise l'environnement
	  <command>cases</command> de  <jlm:latex style="text">\LaTeX</jlm:latex>. Comme l'équation devient  compliquée, elle est
	  composée  dans un  fichier séparé  dont  le nom  est ici  <filename class="libraryfile">eq-2dim.xml</filename>.   Voici
	  d'abord le contenu significatif de ce fichier&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
		 <jlm:latex xmlns:jlm="http://forge.scilab.org/p/jlatexmath">
			   f_i =
			   \begin{cases}
			       1 & \mbox{si } i = 1 \mbox{ ou } i = 2,\\
				   f_{i-1} + f_{i-2} & \mbox{si } i > 2.
			   \end{cases}
		 </jlm:latex>
]]>
</programlisting>

    <para>
	  Le texte du paragraphe ci-dessus qui définit la suite est alors&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
  <para>
	La suite de Fibonacci est définie par&nbsp;:

	<equation xml:id="fibonacci">
	  <title>Définition de la suite de Fibonacci</title>

	  <xi:include 
		  xmlns:xi="http://www.w3.org/2001/XInclude"
		  href="&equations;eq-2dim.xml"
		  parse="xml"/>
	</equation>
  </para>
]]>
</programlisting>

    <para>
	  Ce  programme utilise  les entités  <varname><![CDATA[&nbsp;]]></varname>, qui  est l'entité  permettant  d'insérer une
	  espace typographique insécable  dans le texte et <varname><![CDATA[&projet;]]></varname>, dont la  valeur est le chemin
	  d'accès  au fichier  <filename class="libraryfile">eq-2dim.xml</filename>  dans le  système de  gestion de  fichiers du
	  calculateur hôte. Voyez les références en fin d'article pour savoir comment définir et charger ces entités. Voyez aussi
	  l'en-tête du code source de cet article pour apprendre comment cela a été fait ici.
	</para>

	<note>
	  <title>Fichiers de l'exemple</title>

	  <para>
		Le fichier qui contient le code source  de cet article est <filename>doc-jlatexmath.xml</filename>. Il est placé dans
		le dossier <filename class="directory">xml</filename> du répertoire de la documentation.
	  </para>

	  <para>
		L'équation  de  l'exemple  est  définie   dans  le  fichier  <filename>eq-2dim.xml</filename>  du  dossier  <filename
		class="directory">equations</filename>. Étudiez  ce fichier car  il est légèrement  différent de ce qui  est présenté
		ci-dessus. C'est la version de l'archive de documentation qui doit être utilisée.
	  </para>
	</note>

	<para>
	  Une difficulté plus contraignante est l'élément  <varname>&lt;include&gt;</varname> qui permet de charger le contenu du
	  fichier  désigné pour  l'inclure dans  le texte.   C'est que  les processeurs  XSLT, comme  <command>saxon</command> ou
	  <command>xsltproc</command> par  exemple, ne savent  pas interpréter l'élément  <varname>&lt;include&gt;</varname> pour
	  résoudre les références et inclure des fichiers externes.   La solution consiste à réaliser une compilation du texte en
	  plusieurs passes.  La  première passe utilise le processeur <command>xmllint</command> (noter  les deux caractères 'l')
	  qui résoud les références externes et  compose un fichier <filename class="extension">xml</filename> intermédiaire dans
	  lequel le fichier externe est  chargé à sa place. Les autres passes compilent le  texte du fichier intermédiaire. Voyez
	  les  références en  fin  d'article  pour plus  de  détails sur  l'inclusion  de  fichiers dans  un  texte composé  pour
	  <command>DocBook</command>.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-eq-4"/>.</para>
  </example>

  <example xml:id="ex-eq-5">
	<title>Une équation vraiment compliquée</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  Cette fois, voici un texte mathématique vraiment compliqué. L'expression se présente ainsi&nbsp;:
	</para>

	<xi:include 
		xmlns:xi="http://www.w3.org/2001/XInclude"
		href="&equations;eq-tres-compliquee.xml"/>

	<para>
	  C'est encore une équation définie dans un  fichier <filename class="extension">xml</filename> séparé. Il est inclus par
	  les instructions suivantes&nbsp;:
	</para>

<programlisting language="myxml">
  <![CDATA[
	<xi:include 
		xmlns:xi="http://www.w3.org/2001/XInclude"
		href="&equations;eq-tres-compliquee.xml"/>
  ]]>
</programlisting>

	<para>
	  Le texte de ce fichier est le suivant&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<?xml  version="1.0"  encoding="UTF-8"  ?> 

<para
	xmlns="http://docbook.org/ns/docbook" version="5.0"
	xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
	xml:lang="fr">

  <equation xml:id="eq-tres-compliquee">
	<title>Édition d'une équation complexe</title>

	<jlm:latex>
			  \left\{
			      \begin{array}{l}
				      \dot{x}(t)=

					  \left(
					      \begin{array}{ccccc}
						      0                     &1   &0     &      &0       \\
							  \vdots                &    &\ddots&\ddots&        \\
							  0                     &    &      &\ddots&0       \\
							  \underline{\hat{a}}_k &    &      &0     &1       \\
							  -a_0                  &-a_1&\ldots&\ldots&-a_{n-1}\\
						  \end{array}
					  \right)

					  x(t) +

					  \left(
					      \begin{array}{c}
						      0     \\
							  \vdots\\
							  0     \\
							  \vdots\\
							  1
						  \end{array}
					  \right)
					  e(t)

					  \\

					  s(t) =
					  \left(
					      \begin{array}{ccccccc}
						      b_0 & b_1 & \ldots & b_m & 0 & \ldots & 0\\
						  \end{array}
					  \right)
					  x(t)
				  \end{array}
			  \right.
	</jlm:latex>

	<?linebreak?>
	avec&#xA0;:
	<?linebreak?>

	<jlm:latex>
			  \underbrace{
			      \underline{\hat{a}}_k=
				  \left[
				      \sum_{i=1}^k
					  \frac{\underline{x}_i \underline{x}_i^T}{\sigma_i^2}
				  \right]^{-1}
				  \left[
				      \sum_{i=1}^k
					  \frac{\underline{x}_i y_i}{\sigma_i}
				  \right]
			  }_{D'apr\grave{e}s\ la\ r\grave{e}gle\ \acute{e}nonc\acute{e}e\ plus\ haut}
			  \hspace{1cm} \forall k,\  tel\ que\ 1\leq k < N
	</jlm:latex>
  </equation>
</para>
]]>
</programlisting>

	<para>
	  Le texte placé en indice, sous l'accolade, peut aussi être programmé en utilisant la commande <command>\text</command>,
	  comme ceci&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
		 ...}_{\text{D'après la règle énoncée plus haut}}\hspace etc...
]]>
</programlisting>

	<para>
	  Mais alors, le rendu n'est plus le même.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-eq-5"/>.</para>
  </example>

  <example xml:id="ex-eq-6">
	<title>Un autre exemple non trivial</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  Voici encore une dernière formule compliquée&nbsp;:

		<xi:include 
			xmlns:xi="http://www.w3.org/2001/XInclude"
			href="&equations;eq-tres-compliquee-2.xml"/>
	</para>

	<para>
	  Elle est aussi définie dans un fichier indépendant qui est inclus ici par les instructions&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
	<para>
	  Voici encore une dernière formule compliquée&nbsp;:

		<xi:include 
			xmlns:xi="http://www.w3.org/2001/XInclude"
			href="&equations;eq-tres-compliquee-2.xml"/>
	</para>
]]>
</programlisting>

	<para>
	  Le texte du fichier de définition de la formule est&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<?xml  version="1.0"  encoding="UTF-8"  ?> 

<para
	xmlns="http://docbook.org/ns/docbook" version="5.0"
	xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
	xml:lang="fr">

  <equation xml:id="eq-tres-compliquee-2">
	<title>Nouvelle équation très compliquée</title>

	<jlm:latex>
			 \forall f \in C^\infty
			 \left( 
			     \left[
				     -\frac{T}{2} ; \frac{T}{2} 
				 \right]
			 \right),

			 \forall t \in \left[ -\frac{T}{2} ; \frac{T}{2} \right],

			 f(\tau) = \sum_{k = -\infty}^{+\infty} e^{2i\pi\frac{k}{T}t} \times
			 \underbrace{
			       \frac{1}{T}
				   \int_{-\frac{T}{2}}^{\frac{T}{2}}
				   f(t) e^{-2i\pi\frac{k}{T}t} dt
			 }_{a_k = \tilde{f}\left(\nu = \frac{k}{T}\right)}
	</jlm:latex>
  </equation>
</para>
]]>
</programlisting>

    <para>
	  Là encore  et comme pour l'équation <xref  xlink:href="#matrice"/>, il faudrait faire  quelques efforts supplémentaires
	  pour améliorer la composition. Restons-en là.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-eq-6"/>.</para>
  </example>

  <example xml:id="ex-chimie">
	<title>Édition d'une formule chimique</title>
	<?dbfo keep-together="auto" ?>

	<para>
	  Le dernier exemple montre comment éditer une formule chimique.
	</para>

	<para>
	  <xi:include 
		  xmlns:xi="http://www.w3.org/2001/XInclude"
		  href="&equations;chimie.xml"/>
	</para>

	<para>
	  Il semble  inutile de revenir  sur les instructions  de chargement du  fichier qui définit  l'équation. Le texte  de ce
	  fichier est le suivant&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<?xml  version="1.0"  encoding="UTF-8"  ?> 

<para
	xmlns="http://docbook.org/ns/docbook" version="5.0"
	xmlns:jlm="http://forge.scilab.org/p/jlatexmath"
	xml:lang="fr">

  <equation xml:id="eq-chimie">
	<title>Édition d'une équation en chimie</title>

	<jlm:latex>
	    \begin{eqnarray}
		  MnO_4^- + 8H^+ + 5e^- & 
		  \stackrel{\displaystyle\longrightarrow}{\longleftarrow} & 
		  Mn^{2+} + 4H_2O \\

		  H_2O_2 &  
		  \stackrel{\displaystyle\longrightarrow}{\longleftarrow} & 
		  0_2 + 2H^+ + 2e^- \\
		  
		  <!-- \hline -->

		  2MnO_4^- + 5H_2O_2 + 6H^+ & \longrightarrow & 2Mn^{2+} + 5O_2 + 8H_2O
		\end{eqnarray}
	</jlm:latex>
  </equation>
</para>
]]>
</programlisting>

	<para>
	  La dernière ligne devrait être précédée  d'une ligne horizontale programmée avec la commande <command>\hline</command>,
	  mais celle-ci ne semble pas fonctionner
	  <footnote>
		<para>
		  pour l'instant(<?dbtimestamp format="d-m-Y"?>). La situation doit  évoluer et le problème sera probablement corrigé
		  lorsque vous lirez ces lignes.
		</para>
	  </footnote>.  Ici  encore, des environnements  spécialisés de <jlm:latex style="text">\LaTeX</jlm:latex>  permettent de
	  composer des formules chimiques de  qualité. Ils sont utilisables avec <jlm:latex style="text">\JLaTeXMath</jlm:latex>,
	  mais leur utilisation dépasse le cadre de cette présentation.
	</para>

	<para>Fin de l'<xref xlink:href="#ex-chimie"/>.</para>
  </example>
</section>

<section xml:id="complements">
  <title>Complément : changer les polices de caractères par défaut</title>

  <para>
	Cette section n'expose  pas une fonctionnalité particulière de  <jlm:latex style="text">\JLaTeXMath</jlm:latex>, bien que
	l'archive  intègre  tout   ce  qui  est  nécessaire.   On   souhaite  obtenir  un  rendu  global   du  fichier  <filename
	class="extension">pdf</filename> généré  par <command>FOP</command>  aussi proche  que possible de  celui obtenu  avec du
	&laquo;&nbsp;pur&nbsp;&raquo; <jlm:latex  style="text">\LaTeX</jlm:latex>.  L'objectif  est ambitieux, aussi  allons nous
	nous limiter, pour l'instant, à  préparer l'environnement et la feuille de style pour charger  et utiliser des polices de
	caractères de la  famille <emphasis>Computer Modern (CM)</emphasis>  en remplacement de celles utilisées  par défaut avec
	<command>DocBook</command>. Ce n'est qu'une première tentative, de  portée limitée, afin de rester simple et de permettre
	à tout débutant de  réussir cette évolution. Comme cette évolution est tout à  fait possible indépendamment de <jlm:latex
	style="text">\JLaTeXMath</jlm:latex>,  la suite de  cette section  ne propose  pas d'utiliser  les polices  de caractères
	embarquées dans l'archive du projet. Elle montre comment installer, configurer et utiliser ces polices indépendamment.
  </para>

  <para>
	L'évolution est réalisée en quatre étapes.
  </para>

  <orderedlist>
	<listitem>
	  <para>
		Récupérer   dans   un  dossier   quelconque   les   fichiers  de   polices   de   caractères   au  format   <filename
		class="extension">ttf</filename>                      depuis                      l'adresse                     <link
		xlink:href="http://sourceforge.net/projects/cm-unicode/files/cm-unicode/0.7.0/cm-unicode-0.7.0-ttf.tar.xz"/>&nbsp;;
	  </para>
	</listitem>

	<listitem>
	  <para>
		générer   les    fichiers   de    métriques   des   fonts    à   utiliser    comme   indiqué   à    l'adresse   <link
		xlink:href="http://www.sagehill.net/docbookxsl/AddFont.html"/>          ou         à          l'adresse         <link
		xlink:href="http://xmlgraphics.apache.org/fop/0.95/fonts.html"/>&nbsp;;
	  </para>
	</listitem>

	<listitem>
	  <para>
		modifier le fichier de configuration de <command>FOP</command>  pour définir les nouvelles polices et leurs métriques
		et associer les fichiers correspondants aux noms des polices&nbsp;;
	  </para>
	</listitem>

	<listitem>
	  <para>
		adapter la feuille de style pour charger et utiliser effectivement ces polices.
	  </para>
	</listitem>
  </orderedlist>

  <para>
	Passer ces quatre étapes avec succés n'est pas difficile, mais il faut être attentif et soigneux.
  </para>

  <section xml:id="archive-fonts">
	<title>Télécharger l'archive des polices</title>

	<para>
	   La première étape  est élémentaire. Il s'agit de télécharger  l'archive et de la déballer  dans un dossier quelconque.
	   Dans la suite,  ce dossier est désigné par <filename  class="directory">${FONTS}</filename>. Par conséquent, remplacer
	   partout ce nom par le chemin d'accès complet.
	</para>
  </section>

  <section xml:id="metriques">
	<title>Générer les fichiers de métriques</title>

	<para>
	  Générer les fichiers de métriques est un peu plus délicat. Cet exemple va supposer que nous voulons installer la police
	  de caractères  CMUSerif-Roman.  C'est celle  qui est utilisée dans  le texte que  vous lisez.  Le fichier  qui contient
	  cette font  est <filename>${FONTS}/cmunrm.ttf</filename>.   Pour déterminer  à quelle police  correspond un  fichier du
	  dossier    <filename   class="directory">${FONTS}</filename>,    il   suffit    de   consulter    le    fichier   texte
	  <filename>${FONTS}/Fontmap.CMU</filename>. Pour  observer les  glyphes correspondantes, il  suffit d'ouvrir  le fichier
	  avec le lecteur adapté.
	</para>

	<para>
	  La distribution  de <command>FOP</command>  contient la  classe qui permet  de générer  les métriques.   Soit <filename
	  class="directory">${FOP}</filename>  le  dossier  d'installation.   Ce  dossier contient  les  sous-dossiers  <filename
	  class="directory">${FOP}/build/</filename> et <filename class="directory">${FOP}/lib/</filename>. On commence par faire
	  de ce dernier répertoire le répertoire de travail&nbsp;:
	</para>

	<screen>
	  callisto:~ haro$ cd ${FOP}/lib
	  callisto:lib haro$ 
	</screen>

	<para>
	  Tout ce qui précède  le premier caractère <varname>$</varname> est l'invite du processeur de  commandes et ne doit donc
	  pas être tapé. Le second exemplaire de ce  caractère est le caractère de déréférencement de la variable d'environnement
	  qui  le suit et,  lui, doit  être tapé  si vous  avez défini  cette variable.  Sinon, vous  devez taper  à la  place de
	  <varname>${FOP}</varname>   le   chemin   d'accès  complet   au   dossier   d'installation   de  la   distribution   de
	  <command>FOP</command>  que  vous  utilisez.  Ainsi, par  exemple  sur  le  PC  que  j'utilise pour  saisir  ce  texte,
	  <command>FOP</command> est installé dans le  dossier <filename class="directory">fop-0.95/</filename> de mon répertoire
	  de travail.  Je dois donc taper, après l'invite du processeur de commandes&nbsp;:
	</para>

	<screen>
	  cd ./fop-0.95/lib
	</screen>

	<para>
	  Il suffit alors de lancer la commande de génération des métriques, comme ceci&nbsp;:
	</para>

<screen>
callisto:lib haro$ java -cp \
                   ../build/fop.jar:avalon-framework-4.2.0.jar:\
				   commons-logging-1.0.4.jar:\
				   commons-io-1.3.1.jar:\
				   xmlgraphics-commons-1.3.1.jar \
				   org.apache.fop.fonts.apps.TTFReader \
				   ${FONTS}/cmunrm.ttf \
				   ${FONTS}/cmunrm.xml
</screen>

    <para>
	  Le caractère '\'  en bout de ligne est  le caractère de suite, qui  indique au processeur de commandes  que la commande
	  n'est pas  terminée et qu'elle se  poursuit sur la  ligne suivante. Cette facilité  est utilisée ici pour  améliorer la
	  présentation du texte, mais on peut normalement taper toute la commande sans se préoccuper des retours à la ligne. Bien
	  entendu,  il faut  remplacer  les  indications de  versions  des paquetages  par  les  valeurs de  ceux  que vous  avez
	  effectivement installés avec <command>FOP</command>. 
	</para>

	<para>
	  Remarquer   que   la   commande   ci-dessus   n'est   pas    la   même   que   celle   indiquée   à   l'adresse   <link
	  xlink:href="http://xmlgraphics.apache.org/fop/0.95/fonts.html#Base-14+Fonts"/>.           L'archive           <filename
	  class="libraryfile">xmlgraphics-commons-1.3.1.jar</filename> n'est pas indiquée dans la commande du site.
	</para>

	<para>
	  Lorsque tout se passe bien, le système répond&nbsp;:
	</para>

<screen>
TTF Reader for Apache FOP 0.95

Parsing font...
Reading /Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunrm.ttf...
Font Family: [CMU Serif]
Creating xml font file...
Creating CID encoded metrics...
Writing xml font file /Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunrm.xml...
This font contains no embedding license restrictions.

XML font metrics file successfully created.
callisto:lib haro$
</screen>

    <para>
	  Le    dossier     <filename    class="directory">${FONTS}</filename>     contient    alors    le     nouveau    fichier
	  <filename>cmunrm.xml</filename>  des  métriques.  Cette  génération  doit  être reprise  pour  chacune  des  polices  à
	  installer. 
	</para>

	<para>
	  Les métriques  étant toutes générées, il  faut à présent indiquer  à <command>FOP</command> où trouver  les fichiers de
	  polices et les métriques correspondantes.
	</para>
  </section>

  <section xml:id="configuration-fop">
	<title>Configurer FOP</title>

	<para>
	  Il  s'agit de  modifier le  fichier <filename>${FOP}/conf/fop.xconf</filename>.  Commencer par  en faire  une  copie de
	  sauvegarde. La copie étant réalisée, le fichier est complété ainsi&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
  ...
  <!-- Information for specific renderers -->
  <!-- Uses renderer mime type for renderers -->
  <renderers>
    <renderer mime="application/pdf">
	...
      <fonts>
	  ...


	    <!-- DÉBUT DES COMPLÉMENTS NECESSAIRES AUX NOUVELLES POLICES -->
		<font 
		   metrics-url="file:///Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunrm.xml"
		   kerning="yes"
		   embed-url="file:///Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunrm.ttf">
		  <font-triplet name="CMUSerif-Roman" style="normal" weight="normal"/>
		</font>

		<font 
		   metrics-url="file:///Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunbx.xml"
		   kerning="yes"
		   embed-url="file:///Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunbx.ttf">
		  <font-triplet name="CMUSerif-Roman" style="normal" weight="bold"/>
		</font>

		<font 
		   metrics-url="file:///Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunti.xml"
		   kerning="yes"
		   embed-url="file:///Users/haro/fop-0.95/fonts-LaTeX/cm-unicode.ttf/cmunti.ttf">
		  <font-triplet name="CMUSerif-Roman" style="italic" weight="normal"/>
		</font>
		<!-- FIN DES COMPLÉMENTS NECESSAIRES AUX NOUVELLES POLICES -->


		<directory>/Library/Fonts</directory>
		<auto-detect/>
      </fonts>

      <!-- This option lets you specify additional options on an XML handler -->
      <!--xml-handler namespace="http://www.w3.org/2000/svg">
        <stroke-text>false</stroke-text>
      </xml-handler-->

    </renderer>
	...
]]>
</programlisting>

	<para>
	  Bien entendu,  il faut remplacer les  chemins d'accès des  url à leurs valeurs  effectives dans le SGF  hôte. Attention
	  aussi à bien préfixer chaque URL par  <varname>file:///</varname> avec TROIS caractères '/'. Les attributs de l'élément
	  <varname><![CDATA[<font>]]></varname>           sont           commentés           à          l'adresse           <link
	  xlink:href="http://xmlgraphics.apache.org/fop/0.95/fonts.html"/>.    L'attribut   <varname>embed-url</varname>   permet
	  d'embarquer  dans le  <filename class="directory">pdf</filename>  généré les  fonts correspondantes,  ce qui  permet au
	  visualiseur d'afficher le document, même si la machine sur lequel il est affiché ne dispose pas des polices.
	</para>
  </section>

  <section xml:id="modifier-style">
	<title>Utiliser les nouvelles polices</title>

	<para>
	  Il reste à modifier la feuille de style primaire pour utiliser les nouvelles polices. Pour cela, on ajoute à la feuille
	  de style déjà préparée dans les sections précédentes les éléments suivants&nbsp;:
	</para>

<programlisting language="myxml">
<![CDATA[
<!-- Polices de caractères à utiliser -->
<!-- ... pour le document -->
<xsl:param name="title.font.family">Times New Roman</xsl:param>
<xsl:param name="body.font.family">CMUSerif-Roman</xsl:param>
<xsl:param name="body.font.size">12pt</xsl:param>
<!-- ... pour les listings de programmes -->
<xsl:attribute-set name="monospace.verbatim.properties">
  <xsl:attribute name="font-family">Courier</xsl:attribute>
  <xsl:attribute name="font-size">9pt</xsl:attribute>
</xsl:attribute-set>
]]>
</programlisting>

	<para>
	  Ce sont exactement les  paramètres utilisés pour préparer le document que vous lisez.  Cependant, il est aussi possible
	  de s'en tenir  aux polices installées par défaut avec <jlm:latex  style="text">\JLaTeXMath</jlm:latex>. Voyez pour cela
	  le fichier <filename>examples/latex.xsl</filename>  dans l'archive du projet. Vous obtiendrez  les mêmes résultats avec
	  moins   d'efforts.   Encore   une   fois,   la   procédure   décrite   ci-dessus   est   indépendante   de   <jlm:latex
	  style="text">\JLaTeXMath</jlm:latex> et permet d'installer une police quelconque.
	</para>

	<para>
	  Il faudra, dorénavant, lancer <command>FOP</command> avec  l'option <option>-c</option>, complétée du chemin d'accès au
	  nouveau fichier de configuation, comme ceci par exemple&nbsp;:
	</para>

	<screen>
	  callisto:xml haro$ fop -c ${FOP}/conf/fop.xconf \
	                            ${FO}/doc-jlatexmath.fo 
					         -pdf ${JLATEXMATH}/imprimables/doc-jlatexmath.pdf
	</screen>

	<para>
	  <varname>${FOP}</varname>  est le  dossier d'installation  de <command>FOP</command>,  <varname>${FO}</varname>  est le
	  dossier  qui  reçoit  le  fichier  intermédiaire  au  format  <filename  class="extension">fo</filename>  à  convertir.
	  <varname>${JLATEXMATH}</varname> est  le dossier du projet actuellement  en développement. Dans cet  exemple, il s'agit
	  tout simplement de la documentation que vous lisez.
	</para>

	<para>
	  Il ne vous reste  plus qu'à expérimenter vos propres configurations.  Les références précédentes  et celles de la <xref
	  xlink:href="#references"/>, devraient vous y aider.
	</para>
  </section>
</section>

<section xml:id="listing">
  <title><jlm:latex style="text">\LaTeX</jlm:latex> dans les sources de programmes</title>

  <para>
	Lorsque  le document expose  des sources  de programmes  informatiques, il  peut être  intéressant d'embarquer,  dans les
	commentaires      du      programme,      des      expressions     mathématiques      composées      avec      <jlm:latex
	style="text">\JLaTeXMath</jlm:latex>. Cette  section montre  un exemple  simple de documentation  embarquée dans  le code
	source d'un programme.
  </para>

  <para>
	Le code source d'un  programme informatique est inséré dans un document au  format <command>DocBook</command> à l'aide de
	l'élément <varname><![CDATA[<programlisting>]]></varname>.  L'attribut  <varname>language</varname> de cet élément permet
	de  préciser  le  langage  informatique  dans  lequel  est  écrit  le  code  du  programme.   Des  <command>API</command>
	complémentaires autorisent, par  exemple, la coloration syntaxique  du code. Les lecteurs intéressés  trouveront tous les
	renseignements nécessaires à l'adresse <link xlink:href="http://www.sagehill.net/docbookxsl/ProgramListings.html"/> ainsi
	qu'à l'adresse <link xlink:href="http://xmlguru.cz/2006/07/docbook-syntax-highlighting"/>.
  </para>

  <para>
	Voici un exemple de présentation de code source. Il s'agit d'un extrait d'une classe écrite en langage Eiffel.
  </para>

<programlisting language="eiffel">
indexing
	description :
		"{
		Le terme de rang `n' de la suite de Fibonacci (Version récursive 
		terminale).
		La suite de Fibonacci est définie par :
			<xi:include 
				xmlns:xi="http://www.w3.org/2001/XInclude"
				href="&equations;eq-2dim.xml"
				parse="xml"/>
		}"
	auteurs       : "Christophe HARO"
	copyright_auteur  : "Auteur  : (c) Christophe HARO, 2010"
	licenses_url  : "http://www.gnu.org/licences/gpl-3-0.html"
	licence       : "GPL"
	projet        : "JLATEXMATH"
	dossier       : "${DOCBOOK}/jlatexmath/"
	fichier       : "fibo.e"
	date          : "$Date: 2010-04-16 16:31:47 +0200 (Ven 16 avr 2010) $"
	revision      : "$Revision: 16 $"
	url           : "$HeadURL: svn://localhost/jlatexmath/xml/doc-jlatexmath.xml $"
	modifications : "$Author: haro $"	
		
...

feature -- Requête publique

	fibonacci(n : INTEGER) : INTEGER is
			-- Le terme de rang `n'
		require
			n > 0
			
		do
			Result := fibo(n, 1, 1)
			
		ensure
			"{ Result = le terme de rang `n'}"
		end
		
feature {} -- Requête privée

	fibo(n, F1, Resultat : INTEGER) : INTEGER is
	        -- Le terme de rang `n'
		do
			if n &lt; 3 then
				Result := Resultat
			else
				Result := fibo(n-1, Resultat, Resultat + F1)
			end
		end
		
... 
</programlisting>

  <para>
	Remarquer quelques  défauts dans  ce texte. D'une  part, la coloration  syntaxique est  perdue après l'inclusion  dans le
	commentaire d'en-tête. D'autre part, il n'est pas possible  de réaliser une double inclusion. Il serait ainsi interessant
	de pouvoir programmer&nbsp;:
  </para>

<programlisting language="myxml">
<![CDATA[
		 <xi:include 
		     xmlns:xi="http://www.w3.org/2001/XInclude"
			 href="&programmes;fibo.e"
			 parse="text"/>
]]>
</programlisting>

  <para>
	Le programme source serait chargé  et chargerait à son tour la formule. Cette double  inclusion ne semble pas fonctionner
	ici.
  </para>
</section>



<section xml:id="references">
  <title>Webographie</title>

  <para>
	Le     projet     <jlm:latex     style="text">\JLaTeXMath</jlm:latex>     est    accessible     à     l'adresse     <link
	xlink:href="http://forge.scilab.org/index.php/p/jlatexmath/"/>.
  </para>

  <para>
	Le site du projet <command>DocBook</command> est <link xlink:href="http://docbook.sourceforge.net/"/>. 
  </para>

  <para>
	Une référence <emphasis role="bold">indispensable</emphasis>  sur <command>DocBook</command> et l'adaptation des feuilles
	de styles est <link xlink:href="http://www.sagehill.net/docbookxsl/"/>. On  y trouve une documentation claire et complète
	dispensée par un professionnel, par ailleurs développeur des feuilles de styles.
  </para>

  <para>
	EMACS    est    l'éditeur    de    texte    utilisé    pour    composer    ce    document.     Le    site    est    <link
	xlink:href="http://www.gnu.org/software/emacs/"/>.   Le  mode  nXML  de  cet  éditeur  est  un  paquetage  complémentaire
	disponible à l'adresse <link xlink:href="http://www.thaiopensource.com/nxml-mode/"/>.
  </para>
</section>

<section xml:id="license" xml:lang="en">
  <title>GNU Free Documentation License</title>

  <para>
	See <link xlink:href="http://www.gnu.org/licenses/gpl-3.0.html"/>.
  </para>
</section>

</article>
